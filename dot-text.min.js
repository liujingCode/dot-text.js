!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e():"function"==typeof define&&define.amd?define(e):e()}(0,function(){"use strict";var t,e,i=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var i=[],n=!0,o=!1,r=void 0;try{for(var a,h=t[Symbol.iterator]();!(n=(a=h.next()).done)&&(i.push(a.value),!e||i.length!==e);n=!0);}catch(t){o=!0,r=t}finally{try{!n&&h.return&&h.return()}finally{if(o)throw r}}return i}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}t=function(){var t=function(){function t(e){var i=e.x,n=e.y,o=e.r,a=e.c;r(this,t),this.x=i,this.y=n,this.r=o,this.c=a,this.a=0,this.s=1,this.n=null}return n(t,[{key:"update",value:function(){if(this.n){var t,e,i=this.n,n=i.t,o=i.d;switch(n){case 1:this._r&&(this.r=this._r,Reflect.deleteProperty(this,"_r"));var r=(t=[o.x,o.y],e=[this.x,this.y],Math.pow(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2),.5)),a=o.x-this.x,h=o.y-this.y;this.x+=Math.sign(a)*Math.max(Math.abs(a),10)*.08,this.y+=Math.sign(h)*Math.max(Math.abs(h),10)*.08,this.a=1-(r-10)/200,r<1&&(this.n={t:2,d:{x:o.x,y:o.y}});break;case 2:this.x=o.x-Math.sin(Math.random()*Math.PI),this.y=o.y-Math.sin(Math.random()*Math.PI);break;case 3:this._r||(this._r=this.r),this.a-=.08,this.r-=.2,this.r<.2&&(this.s=-1,this.n=null)}}}},{key:"draw",value:function(t){var e,i,n,o;t.fillStyle=(e=this.c.r,i=this.c.g,n=this.c.b,o=this.a,"rgba("+e+","+i+","+n+","+o+")"),t.beginPath(),t.arc(this.x,this.y,this.r,0,2*Math.PI),t.closePath(),t.fill()}},{key:"move",value:function(t,e){this.n={t:1,d:{x:t,y:e}}}},{key:"remove",value:function(){this.n={t:3}}}]),t}(),e=function(){var t=void 0,e=void 0;t=document.createElement("canvas"),e=t.getContext("2d");var i=function(t,i){e.fillStyle="#000",e.textBaseline="middle",e.textAlign="center",e.font="bold "+t+"px "+i};return{text_shape:function(n,o){var r=o.dot_gap,a=void 0===r?14:r,h=o.text_size,s=void 0===h?300:h,l=o.text_family,f=void 0===l?"'Microsoft YaHei', Helvetica, Arial, monospace":l;e.clearRect(0,0,t.width,t.height),i(s,f);var c=[e.measureText(n).width,s],u=c[0],d=c[1];t.width=u+a-u%a,t.height=d,i(s,f),e.fillText(n,t.width/2,t.height/2);for(var y=e.getImageData(0,0,t.width,t.height).data,v=[],_=3,p=0,g=0;_<y.length;)y[_]>0&&v.push([p,g]),_+=4*a,(p+=a)>=t.width&&(p-=t.width,g+=a,_+=4*a*t.width);return{pos:v,w:u,h:d}}}}();return function(){function o(t){r(this,o),this._ctx=t.getContext("2d"),t.width=t.offsetWidth,t.height=t.offsetHeight,this._w=t.width,this._h=t.height,this._dots=[],this._last=Date.now(),this._go()}return n(o,[{key:"text",value:function(n){var o=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._last=Date.now(),this._param=[n,r];var a=e.text_shape(n,r),h=a.pos,s=a.w,l=a.h;h=function(t){t=t.slice();for(var e=[];t.length;)e.push(t.splice(Math.floor(Math.random()*t.length),1)[0]);return e}(h),(r.dot_size||r.dot_color)&&this._dots.forEach(function(t){t.c=r.dot_color||t.c,t.r=r.dot_size||t.r});var f=[this._dots.length,h.length],c=f[0],u=f[1];this.clear([u,c]);var d=(this._w-s)/2,y=(this._h-l)/2;h.forEach(function(e,n){var a=i(e,2),h=a[0],s=a[1],l=void 0;n<c?l=o._dots[n]:(l=new t({x:Math.random()*o._w,y:Math.random()*o._h,r:r.dot_size||5,c:r.dot_color||{r:255,g:255,b:255}}),o._dots.push(l)),l.move(h+d,s+y)})}},{key:"clear",value:function(t){var e=this;this._last=Date.now();var n=this._last,o=t||[0,this._dots.length],r=i(o,2),a=r[0],h=r[1],s=this._dots.slice(a,h);requestAnimationFrame(function t(){if(!(n<e._last)){var i=s.splice(0,Math.ceil(s.length/25));i.length&&(i.forEach(function(t){t.remove()}),requestAnimationFrame(t))}})}},{key:"resize",value:function(){var t=this,e=this._ctx.canvas;this._w=e.width=e.offsetWidth,this._h=e.height=e.offsetHeight,this._param&&(clearTimeout(this._resizing),this._resizing=setTimeout(function(){t.text.apply(t,function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}(t._param)),Reflect.deleteProperty(t,"_resizing")},200))}},{key:"_go",value:function(){var t=this,e=this._ctx;e.clearRect(0,0,this._w,this._h),this._dots.forEach(function(i,n){-1!==i.s?(i.update(),i.draw(e)):t._dots.splice(n,1)}),requestAnimationFrame(this._go.bind(this))}}]),o}()},e="object"===("undefined"==typeof self?"undefined":o(self))&&self.self===self&&self||"object"===("undefined"==typeof global?"undefined":o(global))&&global.global===global&&global,"function"==typeof define&&define.amd?define([],function(){e.DotText=t()}):"object"===("undefined"==typeof exports?"undefined":o(exports))?module.exports=t():e.DotText=t()});
