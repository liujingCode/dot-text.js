!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.DotText=i()}(this,function(){"use strict";var t=function(){return function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,i){var e=[],r=!0,n=!1,h=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(e.push(a.value),!i||e.length!==i);r=!0);}catch(t){n=!0,h=t}finally{try{!r&&s.return&&s.return()}finally{if(n)throw h}}return e}(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function t(t,i){for(var e=0;e<i.length;e++){var r=i[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(i,e,r){return e&&t(i.prototype,e),r&&t(i,r),i}}();function e(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(i){var r=i.x,n=i.y,h=i.r,a=i.c;e(this,t),this.x=r,this.y=n,this.r=h,this.c=a,this.a=0,this.s=1,this.n=null}return i(t,[{key:"update",value:function(){if(this.n){var t,i,e=this.n,r=e.t,n=e.d;switch(r){case 1:this._r&&(this.r=this._r,Reflect.deleteProperty(this,"_r"));var h=(t=[n.x,n.y],i=[this.x,this.y],Math.pow(Math.pow(t[0]-i[0],2)+Math.pow(t[1]-i[1],2),.5)),a=n.x-this.x,s=n.y-this.y;this.x+=Math.sign(a)*Math.max(Math.abs(a),10)*.08,this.y+=Math.sign(s)*Math.max(Math.abs(s),10)*.08,this.a=1-(h-10)/200,h<1&&(this.n={t:2,d:{x:n.x,y:n.y}});break;case 2:this.x=n.x-Math.sin(Math.random()*Math.PI),this.y=n.y-Math.sin(Math.random()*Math.PI);break;case 3:this._r||(this._r=this.r),this.a-=.08,this.r-=.2,this.r<.2&&(this.s=-1,this.n=null)}}}},{key:"draw",value:function(t){var i,e,r,n;t.fillStyle=(i=this.c.r,e=this.c.g,r=this.c.b,n=this.a,"rgba("+i+","+e+","+r+","+n+")"),t.beginPath(),t.arc(this.x,this.y,this.r,0,2*Math.PI),t.closePath(),t.fill()}},{key:"move",value:function(t,i){this.n={t:1,d:{x:t,y:i}}}},{key:"remove",value:function(){this.n={t:3}}}]),t}(),n=function(){var t=void 0,i=void 0;t=document.createElement("canvas"),i=t.getContext("2d");var e=function(t,e){i.fillStyle="#000",i.textBaseline="middle",i.textAlign="center",i.font="bold "+t+"px "+e};return{textShape:function(r,n){var h=n.gap,a=void 0===h?14:h,s=n.textSize,o=void 0===s?300:s,c=n.textFamily,l=void 0===c?"'Microsoft YaHei', Helvetica, Arial, monospace":c;i.clearRect(0,0,t.width,t.height),e(o,l);var u=[i.measureText(r).width,o],f=u[0],d=u[1];t.width=f+a-f%a,t.height=d,e(o,l),i.fillText(r,t.width/2,t.height/2);for(var v=i.getImageData(0,0,t.width,t.height).data,y=[],g=3,_=0,m=0;g<v.length;)v[g]>0&&y.push([_,m]),g+=4*a,(_+=a)>=t.width&&(_-=t.width,m+=a,g+=4*a*t.width);return{pos:y,w:f,h:d}}}}();return function(){function h(t){e(this,h),this._ctx=t.getContext("2d"),t.width=t.offsetWidth,t.height=t.offsetHeight,this._w=t.width,this._h=t.height,this._dots=[],this._last=Date.now(),this._go()}return i(h,[{key:"text",value:function(i){var e=this,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._last=Date.now(),this._param=[i,h];var a=n.textShape(i,h),s=a.pos,o=a.w,c=a.h;s=function(t){t=t.slice();for(var i=[];t.length;)i.push(t.splice(Math.floor(Math.random()*t.length),1)[0]);return i}(s),(h.dotSize||h.dotColor)&&this._dots.forEach(function(t){t.c=h.dotColor||t.c,t.r=h.dotSize||t.r});var l=[this._dots.length,s.length],u=l[0],f=l[1];this.clear([f,u]);var d=(this._w-o)/2,v=(this._h-c)/2;s.forEach(function(i,n){var a=t(i,2),s=a[0],o=a[1],c=void 0;n<u?c=e._dots[n]:(c=new r({x:Math.random()*e._w,y:Math.random()*e._h,r:h.dotSize||5,c:h.dotColor||{r:255,g:255,b:255}}),e._dots.push(c)),c.move(s+d,o+v)})}},{key:"clear",value:function(i){var e=this;this._last=Date.now();var r=this._last,n=i||[0,this._dots.length],h=t(n,2),a=h[0],s=h[1],o=this._dots.slice(a,s);requestAnimationFrame(function t(){if(!(r<e._last)){var i=o.splice(0,Math.ceil(o.length/25));i.length&&(i.forEach(function(t){t.remove()}),requestAnimationFrame(t))}})}},{key:"resize",value:function(){var t=this,i=this._ctx.canvas;this._w=i.width=i.offsetWidth,this._h=i.height=i.offsetHeight,this._param&&(clearTimeout(this._resizing),this._resizing=setTimeout(function(){t.text.apply(t,function(t){if(Array.isArray(t)){for(var i=0,e=Array(t.length);i<t.length;i++)e[i]=t[i];return e}return Array.from(t)}(t._param)),Reflect.deleteProperty(t,"_resizing")},100))}},{key:"_go",value:function(){var t=this,i=this._ctx;i.clearRect(0,0,this._w,this._h),this._dots.forEach(function(e,r){-1!==e.s?(e.update(),e.draw(i)):t._dots.splice(r,1)}),requestAnimationFrame(this._go.bind(this))}}]),h}()});
