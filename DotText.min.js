"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _slicedToArray=function(){function t(t,e){var i=[],n=!0,o=!1,r=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(i.push(a.value),!e||i.length!==e);n=!0);}catch(t){o=!0,r=t}finally{try{!n&&s.return&&s.return()}finally{if(o)throw r}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t){var e="object"==("undefined"==typeof self?"undefined":_typeof(self))&&self.self===self&&self||"object"==("undefined"==typeof global?"undefined":_typeof(global))&&global.global===global&&global;"function"==typeof define&&define.amd?define([],function(){e.DotText=t()}):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.DotText=t()}(function(){var t=function(t,e){return Math.pow(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2),.5)},e=function(t,e,i,n){return"rgba("+t+","+e+","+i+","+n+")"},i=function(t){t=t.slice();for(var e=[];t.length;)e.push(t.splice(Math.floor(Math.random()*t.length),1)[0]);return e},n=function(){function i(t){var e=t.x,n=t.y,o=t.r,r=t.c;_classCallCheck(this,i),this.x=e,this.y=n,this.r=o,this.c=r,this.a=0,this.s=1,this.n=null}return _createClass(i,[{key:"update",value:function(){if(this.n){var e=this.n,i=e.t,n=e.d;switch(i){case 1:var o=t([n.x,n.y],[this.x,this.y]),r=n.x-this.x,a=n.y-this.y;this.x+=Math.sign(r)*Math.max(Math.abs(r),10)*.08,this.y+=Math.sign(a)*Math.max(Math.abs(a),10)*.08,this.a=1-(o-10)/200,o<1&&(this.n={t:2,d:{x:n.x,y:n.y}});break;case 2:this.x=n.x-Math.sin(Math.random()*Math.PI),this.y=n.y-Math.sin(Math.random()*Math.PI);break;case 3:this.a-=.08,this.r-=.2,this.r<.2&&(this.s=-1,this.n=null)}}}},{key:"draw",value:function(t){t.fillStyle=e(this.c.r,this.c.g,this.c.b,this.a),t.beginPath(),t.arc(this.x,this.y,this.r,0,2*Math.PI),t.closePath(),t.fill()}},{key:"move",value:function(t,e){this.n={t:1,d:{x:t,y:e}}}},{key:"remove",value:function(){this.n={t:3}}}]),i}(),o=function(){var t=void 0,e=void 0;t=document.createElement("canvas"),e=t.getContext("2d");var i=function(t,i){e.fillStyle="#000",e.textBaseline="middle",e.textAlign="center",e.font="bold "+t+"px "+i};return{text_shape:function(n,o){var r=o.dot_gap,a=void 0===r?14:r,s=o.text_size,h=void 0===s?300:s,l=o.text_family,c=void 0===l?"'Microsoft YaHei', Helvetica, Arial, monospace":l;e.clearRect(0,0,t.width,t.height),i(h,c);var f=[e.measureText(n).width,h],u=f[0],d=f[1];t.width=u+a-u%a,t.height=d,i(h,c),e.fillText(n,t.width/2,t.height/2);for(var y=e.getImageData(0,0,t.width,t.height).data,_=[],v=3,p=0,g=0;v<y.length;)y[v]>0&&_.push([p,g]),v+=4*a,p+=a,p>=t.width&&(p-=t.width,g+=a,v+=4*a*t.width);return{pos:_,w:u,h:d}}}}(),r=function(){function t(e){_classCallCheck(this,t),this._ctx=e.getContext("2d"),e.width=e.offsetWidth,e.height=e.offsetHeight,this._w=e.width,this._h=e.height,this._dots=[],this._last=Date.now(),this._go()}return _createClass(t,[{key:"text",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._last=Date.now(),this._param=[t,r];var a=o.text_shape(t,r),s=a.pos,h=a.w,l=a.h;s=i(s),(r.dot_size||r.dot_color)&&this._dots.forEach(function(t){t.c=r.dot_color||t.c,t.r=r.dot_size||t.r});var c=[this._dots.length,s.length],f=c[0],u=c[1];this.clear([u,f]);var d=(this._w-h)/2,y=(this._h-l)/2;s.forEach(function(t,i){var o=_slicedToArray(t,2),a=o[0],s=o[1],h=void 0;i<f?h=e._dots[i]:(h=new n({x:Math.random()*e._w,y:Math.random()*e._h,r:r.dot_size||5,c:r.dot_color||{r:255,g:255,b:255}}),e._dots.push(h)),h.move(a+d,s+y)})}},{key:"clear",value:function(t){var e=this;this._last=Date.now();var i=this._last,n=t?t:[0,this._dots.length],o=_slicedToArray(n,2),r=o[0],a=o[1],s=this._dots.slice(r,a),h=function t(){if(!(i<e._last)){var n=s.splice(0,Math.ceil(s.length/25));n.length&&(n.forEach(function(t){t.remove()}),requestAnimationFrame(t))}};requestAnimationFrame(h)}},{key:"resize",value:function(){var t=this,e=this._ctx.canvas;this._w=e.width=e.offsetWidth,this._h=e.height=e.offsetHeight,this._param&&(clearTimeout(this._resizing),this._resizing=setTimeout(function(){t.text.apply(t,_toConsumableArray(t._param)),Reflect.deleteProperty(t,"_resizing")},200))}},{key:"_go",value:function(){var t=this,e=this._ctx;e.clearRect(0,0,this._w,this._h),this._dots.forEach(function(i,n){return i.s===-1?void t._dots.splice(n,1):(i.update(),void i.draw(e))}),requestAnimationFrame(this._go.bind(this))}}]),t}();return r});